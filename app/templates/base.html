<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}OAZ IA Profiler{% endblock %}</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
    <script src="https://unpkg.com/alpinejs@3.13.3/dist/cdn.min.js" defer></script>
    <style>
        [x-cloak] { display: none !important; }
    </style>
    <script>
    window.rpaLog = {
        send: function(type, action, details) {
            fetch('/admin/frontend-log', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({type: type, action: action, details: details || {}})
            }).catch(function(e) { console.log('RPA log error:', e); });
        },
        click: function(action, details) { this.send('click', action, details); },
        tab: function(action, details) { this.send('tab', action, details); },
        form: function(action, details) { this.send('form', action, details); },
        page: function(action, details) { this.send('page', action, details); },
        error: function(action, details) { this.send('error', action, details); }
    };
    document.addEventListener('DOMContentLoaded', function() {
        var pagePath = window.location.pathname;
        rpaLog.page('load', {path: pagePath, title: document.title});
        document.addEventListener('click', function(e) {
            var target = e.target;
            var tagName = target.tagName.toLowerCase();
            if (tagName === 'button' || tagName === 'a' || target.closest('button') || target.closest('a')) {
                var btn = target.closest('button') || target.closest('a') || target;
                var text = btn.innerText ? btn.innerText.substring(0, 50) : '';
                var id = btn.id || '';
                var cls = btn.className ? btn.className.substring(0, 100) : '';
                var href = btn.href || '';
                rpaLog.click('button', {text: text, id: id, class: cls, href: href, page: pagePath});
            }
        });
        document.querySelectorAll('form').forEach(function(form) {
            form.addEventListener('submit', function(e) {
                var formId = form.id || form.action || 'unknown';
                rpaLog.form('submit', {form_id: formId, page: pagePath});
            });
        });
        document.querySelectorAll('[role="tab"], .tab, [data-tab]').forEach(function(tab) {
            tab.addEventListener('click', function() {
                var tabName = tab.innerText || tab.getAttribute('data-tab') || 'unknown';
                rpaLog.tab('click', {tab: tabName, page: pagePath});
            });
        });
        document.querySelectorAll('input, select, textarea').forEach(function(input) {
            input.addEventListener('change', function() {
                var inputName = input.name || input.id || 'unknown';
                var inputType = input.type || input.tagName.toLowerCase();
                rpaLog.send('input', 'change', {name: inputName, type: inputType, page: pagePath});
            });
        });
    });
    window.onerror = function(msg, url, line, col, error) {
        rpaLog.error('js_error', {message: msg, url: url, line: line, col: col});
        return false;
    };
    </script>
</head>
<body class="bg-gray-50 min-h-screen">
    <nav class="bg-white shadow-sm border-b border-gray-200">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <h1 class="text-xl font-bold text-gray-900">OAZ IA Profiler</h1>
                </div>
                {% if session.get('user_id') and session.get('email') %}
                <div class="flex items-center space-x-4">
                    <span class="text-sm text-gray-600">{{ session.get('email') }}</span>
                    <a href="/auth/logout" class="text-sm text-blue-600 hover:text-blue-800">Sair</a>
                </div>
                {% else %}
                <div class="flex items-center">
                    <a href="/admin/login" class="text-sm text-gray-600 hover:text-gray-800">Admin</a>
                </div>
                {% endif %}
            </div>
        </div>
    </nav>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        {% block content %}{% endblock %}
    </main>

    <footer class="mt-auto border-t border-gray-200 bg-white">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
            <p class="text-center text-sm text-gray-500">
                © 2025 OAZ - Avaliação de Proficiência em IA
            </p>
        </div>
    </footer>
</body>
</html>
